[tox]
envlist = py310,py311,py312,lint,security
skipsdist = True
isolated_build = False

[testenv]
# Test environment for running unit tests
deps =
    pytest>=8.0.0
    pytest-cov>=4.1.0
    pytest-mock>=3.12.0
    requests>=2.31.0
    beautifulsoup4>=4.11.0
    
commands =
    pytest tests/test_safety_helpers.py -v --tb=short --cov=src/passive_osint_common --cov-report=term-missing --cov-report=html

[testenv:lint]
# Linting environment
deps =
    black>=23.0.0
    ruff>=0.1.0
    mypy>=1.5.0
    
commands =
    black --check src/ tests/
    ruff check src/ tests/
    mypy src/ --ignore-missing-imports

[testenv:security]
# Security scanning environment
deps =
    safety>=2.3.0
    bandit>=1.7.0
    
commands =
    # Check dependencies for vulnerabilities
    safety check --json
    
    # Security linting
    bandit -r src/ -f screen

[testenv:format]
# Code formatting environment
deps =
    black>=23.0.0
    isort>=5.12.0
    
commands =
    black src/ tests/
    isort src/ tests/

[testenv:coverage]
# Full test coverage report
deps =
    pytest>=8.0.0
    pytest-cov>=4.1.0
    
commands =
    pytest tests/ -v --cov=src --cov=modules --cov-report=term-missing --cov-report=html --cov-report=xml

[testenv:docs]
# Documentation building (placeholder for future)
deps =
    sphinx>=5.0.0
    sphinx-rtd-theme>=1.2.0
    
commands =
    # sphinx-build -b html docs/ docs/_build/html
    echo "Documentation building not yet configured"

[pytest]
# Pytest configuration
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = 
    -v
    --tb=short
    --strict-markers
    --disable-warnings

markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    asyncio: marks tests that require the pytest-asyncio plugin

[coverage:run]
source = src,modules
omit = 
    */tests/*
    */test_*
    */__pycache__/*
    */site-packages/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False

[flake8]
max-line-length = 88
extend-ignore = E203,W503
exclude = 
    .git,
    __pycache__,
    .tox,
    .eggs,
    *.egg,
    build,
    dist,
    .venv,
    venv,
    osint_env

[mypy]
python_version = 3.10
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = False
ignore_missing_imports = True

[isort]
profile = black
line_length = 88
